NAP=NAP||{},NAP.placeholderPolyfill=NAP.placeholderPolyfill||function(){};var LivePerson=function(){function SessionStore(a,b,c){function d(b,c){cacheStore[b]=c,CookieUtil.setSessionCookieWithPath(a+"."+b,c,"/")}function e(b){var c=CookieUtil.getCookie(a+"."+b);return c}function f(){for(var b in cacheStore)CookieUtil.setSessionCookieWithPath(a+"."+b,"","/")}cacheStore={};for(var g in b)b.hasOwnProperty(g)&&(cacheStore[g]=b[g]);return this.setData=d,this.getData=e,this.clear=f,this}function bootstrap(a,b,c){oldJquery=!("function"==typeof $.prop),a.onInit=myOnInit,a.onLoad=myOnLoad,a.onLine=myOnLine,a.onError=myOnError,a.onResume=myOnResume,a.onStart=myOnStart,a.onStop=myOnStop,a.onState=myOnState,a.onAgentTyping=myOnAgentTyping,b.db1={},b.db1.dbClicked=initFromButton,b.InviteOpenChat=initFromInvite,lpAddScript(),c&&initFromResume(c)}function initFromInvite(){init(FROM_INVITE)}function initFromButton(objName,buttonState){var objRef=eval(objName);return init(FROM_BUTTON,objRef.getActionURL(buttonState)),!1}function initFromResume(a){init(FROM_RESUME,a)}function init(a,b){oldJquery=!("function"==typeof $.prop),initSource=a,initParam=b,"undefined"!=typeof lpChat?createLPC():doCreateLPC=!0}function start(){isStarted||(isStarted=!0,injectHTML(),setupChat())}function injectHTML(){var a=['<div id="chat-window" class="chat-container">','<div class="chat-resizer"><div></div></div>','<div class="win-options">','<div class="chat-header">','<div class="minimise-button header-button"></div>','<div class="chat-header-text"><h2>'+NAP.i18n.translate("live-chat.liveChat")+"</h2></div>",'<div class="close-button header-button"></div>','<div class="clear"></div>',"</div>","</div>",'<div class="chat-inner">','<div class="confirm-close content-box">','<div class="chat-bridge">','<div class="confirm-close-text">',"<p>"+NAP.i18n.translate("live-chat.confirmClose")+"</p>","</div>",'<div class="confirm-close-buttons">','<input type="button" class="yes-button primary action-button" value="'+NAP.i18n.translate("live-chat.yes")+'" />','<input type="button" class="no-button secondary deny-button" value="'+NAP.i18n.translate("live-chat.no")+'" />',"</div>","</div>","</div>",'<div class="content content-box">',"</div>","</div>","</div>"].join("");$("body").append(a),$chatWindow=$("#chat-window"),$titleBar=$chatWindow.find(".win-options"),$innerContent=$chatWindow.find(".chat-inner"),$confirmClose=$chatWindow.find(".confirm-close"),$content=$chatWindow.find(".content"),$resizer=$chatWindow.find(".chat-resizer")}function setupChat(){switch(initHeader(),initSource){case FROM_BUTTON:updateState(STATE_INTRO);break;default:updateState(STATE_CHATTING)}}function initHeader(){$titleBar.find(".minimise-button").andSelf().click(function(){toggleExpand();var a=1==dataStore.getData("typing");return myOnAgentTyping(a),scrollChatToBottom(),!1}),$titleBar.find(".close-button").click(function(){if(state===STATE_NONE||state===STATE_INTRO||state===STATE_THANKS||state===STATE_OFFLINE||state===STATE_CONFIRM_CLOSE)updateState(STATE_END);else{var a=lpc.getState().id;updateState(2===a||4===a?STATE_CONFIRM_CLOSE:STATE_THANKS)}return!1})}function initDragger(){if(!dragger){var a=chatAreaHeight;if($(".chat-area").height(chatAreaHeight),NAP.ui&&NAP.ui.Dragger){dragger=new NAP.ui.Dragger($resizer,20,chatAreaHeight-100),dragger.init(),dragger.setEnabled(!1),$(dragger).bind("update",function(b,c){if(!($(".chat-area").length<1)){var d=a-c;$(".chat-area").height(d),dataStore.setData("win",d)}});var b=parseInt(dataStore.getData("win"));isResuming&&b&&b>0&&dragger.setOffset(a-b,!0)}}}function updateState(a){var b=state;if(b!==a){switch(prevState=state,state=a,b){case STATE_INTRO:exitIntro();break;case STATE_CHATTING:exitChat();break;case STATE_CONFIRM_CLOSE:exitConfirmClose()}switch(a){case STATE_INTRO:goIntro();break;case STATE_CHATTING:goChat();break;case STATE_CONFIRM_CLOSE:goConfirmClose();break;case STATE_THANKS:goThanks();break;case STATE_END:goEnd();break;case STATE_OFFLINE:goOffline()}}}function autoCollapse(){isExpanded&&-1==autoMinTimeoutId&&(autoMinTimeoutId=setTimeout(function(){isExpanded&&state===STATE_INTRO&&toggleExpand()},1e4))}function removeAutoCollapse(){autoMinTimeoutId>=0&&(clearTimeout(autoMinTimeoutId),autoMinTimeoutId=-1)}function goIntro(){var a=['<div class="chat-intro chat-bridge" style="display:none">',"<h3>"+NAP.i18n.translate("live-chat.needStyleHelp")+"</h3>","<p>"+NAP.i18n.translate("live-chat.talkToExpert")+"</p>",'<input type="button" class="action-button primary start-chat-button" value="'+NAP.i18n.translate("live-chat.startChat")+'" />',"</div>"].join("");$chatWindow.css({width:"35px",height:"35px"}),$content.html(a).parents("#chat-window").animate({height:defaultHeight,width:defaultWidth},"fast"),isExpanded=!0,$(".chat-intro").show(),$content.find(".start-chat-button").click(function(){$chatWindow.css("height",""),updateState(STATE_CHATTING)}),$chatWindow.bind("mouseenter",removeAutoCollapse).bind("mouseleave",autoCollapse),autoCollapse()}function exitIntro(){$content.find(".start-chat-button").unbind("click"),$chatWindow.unbind("mouseenter",removeAutoCollapse).unbind("mouseleave",autoCollapse),removeAutoCollapse()}function goChat(){if(0==$content.find(".chat-section").length){var a=['<div class="chat-section">','<div class="chat-area">','<div class="logs"></div>','<div class="chat-log is-operator is-typing"><span class="person"></span><span class="log">'+NAP.i18n.translate("live-chat.typing")+' <img src="//nap-catalogue.s3-eu-west-1.amazonaws.com/girdle/assets/blinker.gif" width="9" height="2" border="0" alt="" /></span></div>',"</div>",'<div class="chat-input-holder"><textarea class="chat-input disabled" type="text" disabled="disabled" />','<input type="button" class="action-button primary submit-text disabled" value="" disabled="disabled" /><div class="clear"></div></div>',"</div>"].join("");$content.html(a),initSource==FROM_BUTTON?lpc.requestChat():initSource==FROM_INVITE?lpc.requestChatFromInvite():initSource==FROM_RESUME&&(isResuming=!0,$chatWindow.addClass("is-hidden"),lpc.resumeChat(initParam),setTimeout(function(){var a=1==dataStore.getData("typing");a&&myOnAgentTyping(!0)},2e3)),initDragger(),isChatting=!0}$chatWindow.find(".submit-text").click(function(){sendText()}),$chatWindow.find(".chat-input").keydown(function(a){return 13===a.keyCode?(sendText(),lpc.setVisitorTyping(!1),a.preventDefault(),!1):void lpc.setVisitorTyping(!0)}).blur(function(a){lpc.setVisitorTyping(!1)}),$content.show(),dragger&&dragger.setEnabled(!0)}function exitChat(){dragger.setEnabled(!1),$chatWindow.find(".submit-text").unbind("click"),$chatWindow.find(".chat-input").unbind("keydown")}function goConfirmClose(){var a=$chatWindow.height();$content.fadeOut("fast"),$chatWindow.animate({height:"190px"},300,function(){$confirmClose.fadeIn("fast")}),$confirmClose.find(".yes-button").click(function(){return updateState(STATE_THANKS),!1}),$confirmClose.find(".no-button").click(function(){return updateState(STATE_CHATTING),defaultHeight>a?$chatWindow.animate({height:defaultHeight},300,function(){$chatWindow.css("height","")}):$chatWindow.animate({height:a},300,function(){$chatWindow.css("height","")}),!1}),isExpanded||toggleExpand()}function exitConfirmClose(){$confirmClose.find(".yes-button").unbind("click"),$confirmClose.find(".no-button").unbind("click"),$confirmClose.hide()}function goThanks(){isChatting&&(lpc.endChat(),isChatting=!1),$content.html(['<div class="thank-you chat-bridge">',"<h2>"+NAP.i18n.translate("live-chat.thankyou")+"</h2>","</div>"].join("")).fadeIn(300),setTimeout(function(){updateState(STATE_END)},3e3)}function goEnd(){dataStore.clear(),$(".dynamic-button").length>0?$chatWindow.addClass("is-transitioning").animate({height:"33px",width:"37px"},300,function(){$chatWindow.removeClass("is-transitioning"),end()}):$chatWindow.slideUp("fast",function(){end()})}function end(){isStarted=!1,dragger&&(dragger.destroy(),dragger=null),isChatting&&lpc&&(lpc.endChat(),isChatting=!1),$chatWindow.remove()}function goOffline(){isChatting&&lpc.endChat(),$content.html(['<div class="offline chat-bridge">',"<p>"+NAP.i18n.translate("live-chat.offlineMessage")+"</p>",'<input type="button" class="action-button primary end-button" value="'+NAP.i18n.translate("live-chat.offlineOk")+'" />',"</div>"].join("")).show(),$chatWindow.find(".end-button,.cc-overlay").click(function(){updateState(STATE_END)}),$("#LPbutton").remove()}function toggleExpand(a){isExpanded=!isExpanded;var b=a?0:"fast";isExpanded?($innerContent.slideDown(b),$titleBar.find(".notification-icon").remove(),$chatWindow.removeClass("is-collapsed").css("height",""),dragger&&dragger.setEnabled(state===STATE_CHATTING)):($innerContent.slideUp(b),$chatWindow.addClass("is-collapsed").animate({height:defaultButtonHeight},b),dragger&&dragger.setEnabled(!1)),state===STATE_INTRO&&CookieUtil.setCookieWithPath("livePersonVars.inviteMode",isExpanded?0:1,100,"/")}function sendText(){var a=$chatWindow.find(".chat-input"),b=a.val();return b.length>0&&b!==a.attr("placeholder")&&(lpc.addLine(b),myOnLine({by:lpc.getVisitorName(),text:b,type:0}),a.val("")),!0}function addNotification(){if(!$innerContent.is(":visible")){var a=$titleBar.find(".notification-icon");if(a.length>0){var b=a.text();b++,a.text(b)}else{var c='<span class="notification-icon">1</span>';$titleBar.append(c)}}}function addChatText(a){var b=$(".chat-area .logs"),c=$('<div class="chat-log"></div>'),d=parseInt(a.type);switch(d){case 2:case 3:className="is-status";break;case 0:className="is-user";break;default:className="is-operator"}className&&c.addClass(className),a.by&&2!==d&&$('<span class="person"></span>').html(a.by+" ").appendTo(c),$('<span class="log"></span>').html(a.text).appendTo(c),0!==d&&c.find("a").each(function(a,b){var c=$(b);c.attr("href").indexOf("netaporter.com")>=0&&c.attr("target","_self")}),b.append(c),scrollChatToBottom()}function scrollChatToBottom(){var a=$(".chat-area");a.stop().animate({scrollTop:oldJquery?a.attr("scrollHeight"):a.prop("scrollHeight")},300)}function lpAddScript(a,b){var c=lpChatConfig;"undefined"==typeof c.lpProtocol&&(c.lpProtocol=0==document.location.toString().indexOf("https:")?"https":"http"),("undefined"==typeof a||"object"==typeof a)&&(a=c.lpChatSrc?c.lpChatSrc:"/hcp/html/lpChatAPI.js"),0!=a.indexOf("http")?a=c.lpProtocol+"://"+c.jsApiSrcDomain+a+"?site="+c.lpNumber:a.indexOf("site=")<0&&(a+=a.indexOf("?")<0?"?":"&",a=a+"site="+c.lpNumber);var d=document.createElement("script");d.setAttribute("type","text/javascript"),d.setAttribute("charset","iso-8859-1"),d.setAttribute("src",a),document.getElementsByTagName("head").item(0).appendChild(d)}function myOnError(a){return isResuming?(isResuming=!1,void updateState(STATE_END)):void(3==a.id&&updateState(STATE_OFFLINE))}function myOnStart(a,b){}function myOnResume(a,b){$chatWindow.removeClass("is-hidden"),isResuming=!1}function myOnState(){if(isStarted)switch(lpc.getState().id){case 5:case 6:chatEnded();break;case 2:var a=lpc.sessionkey,b=$("#chat-window .chat-input");if(dataStore.setData("session",a),b.attr("placeholder",NAP.i18n.translate("live-chat.placeholder")),!Modernizr.input.placeholder){var c=b.attr("placeholder");b.val(c).focus(function(){$(this).val()==c&&$(this).val("")}).blur(function(){""==$(this).val()&&$(this).val(c)})}NAP.placeholderPolyfill(b),oldJquery?(b.attr("disabled",!1).removeClass("disabled"),$("#chat-window .submit-text").attr("disabled",!1).removeClass("disabled")):(b.prop("disabled",!1).removeClass("disabled"),$("#chat-window .submit-text").prop("disabled",!1).removeClass("disabled")),$chatWindow.removeClass("is-hidden")}}function myOnAgentTyping(a){var b=$chatWindow.find(".is-typing");a?(b.fadeIn(200),b.find(".person").text(lpc.getAgentName()),dataStore.setData("typing",1),scrollChatToBottom()):(b.hide(),dataStore.setData("typing",0))}function myOnLine(a){var b;if(a.time){var b=a.by+a.type+a.time;if(chatLog[b]&&chatLog[b]==a.text)return;if(chatLog[b]=a.text,2==lpc.getState().id){var c=lpc.sessionkey;dataStore.setData("session",c)}}addChatText(a),addNotification()}function chatEnded(){if(isChatting=!1,dataStore.clear(),isResuming&&(isResuming=!1,updateState(STATE_END)),isStarted){var a=$("#chat-window .chat-input");if(oldJquery?(a.attr("disabled","disabled").addClass("disabled"),$("#chat-window .submit-text").attr("disabled","disabled").addClass("disabled")):(a.prop("disabled","disabled").addClass("disabled"),$("#chat-window .submit-text").prop("disabled","disabled").addClass("disabled")),a.attr("placeholder",""),$.browser.msie&&parseFloat($.browser.version)<10){var b=a.attr("placeholder");a.val(b)}}}function myOnStop(a,b){chatEnded(),1==a&&setTimeout(function(){$chatWindow.animate({height:"190px"},300,function(){$content.fadeOut("fast",function(){goThanks()})})},5e3)}function createLPC(){lpc=window.lpc=new lpChat,start()}function myOnLoad(){doCreateLPC&&createLPC()}function myOnInit(){}function sendVarsOnClickSizeGuide(){lpSendData("page","NAP_SizeGuide","true")}var STATE_NONE=-1,STATE_INTRO=0,STATE_CHATTING=1,STATE_CONFIRM_CLOSE=2,STATE_SURVEY=3,STATE_THANKS=4,STATE_END=5,STATE_OFFLINE=6,FROM_INVITE=1,FROM_BUTTON=2,FROM_RESUME=3,isChatting=!1,isExpanded=!0,isResuming=!1,isStarted=!1,prevState=STATE_NONE,state=STATE_NONE,initSource,initParam,doCreateLPC=!1,chatAreaHeight=170,autoMinTimeoutId=-1,defaultHeight=199,defaultWidth="310px",defaultButtonHeight="38px",dragger,lpc,chatLog={},dataStore=new SessionStore("livePersonVars",{win:0,session:0,typing:0}),$chatWindow,$titleBar,$innerContent,$confirmClose,$content,$resizer,oldJquery=!1;return{bootstrap:bootstrap,dataStore:dataStore,sendVarsOnClickSizeGuide:sendVarsOnClickSizeGuide}}();!function(){function a(){"undefined"!=typeof NapForeseeSurvey&&NapForeseeSurvey.setBlockSurvey(!0)}var b=LivePerson.dataStore.getData("session");b&&"-1"!=b?(a(),$(document).ready(function(){LivePerson.bootstrap(lpChatConfig,lpMTagConfig,b)})):$(window).load(function(){LivePerson.bootstrap(lpChatConfig,lpMTagConfig)}),$(document).delegate(".lp-invite-trigger","mousedown",function(){CookieUtil.setCookieWithPath("livePersonVars.inviteMode",0,100,"/")}),$("#filters-size-guide").on("click",function(){LivePerson.sendVarsOnClickSizeGuide()}),$(".sizeConversion").on("click",function(){LivePerson.sendVarsOnClickSizeGuide()})}(),lpMTagConfig.inviteChatShown=function(a){function b(a,b){if(g!==a){g=a;var c=b?0:"fast";g?(f.slideDown(c),d.removeClass("is-collapsed")):(f.slideUp(c),d.addClass("is-collapsed")),h>-1&&(clearTimeout(h),h=-1),CookieUtil.setCookieWithPath("livePersonVars.inviteMode",g?0:1,100,"/")}}function c(){g&&-1==h&&(h=setTimeout(function(){b(!1)},1e4))}var d=$("#chat-invite"),e=d.find(".win-options"),f=d.find(".chat-inner"),g=!0,h=-1;e.find(".minimise-button").andSelf().click(function(){return b(!g),!1}),d.bind("mouseenter",function(){h>=0&&(clearTimeout(h),h=-1)}).bind("mouseleave",c);var i=1==CookieUtil.getCookie("livePersonVars.inviteMode");return i?b(!1,!0):(d.hide().slideDown("fast"),c()),!0};