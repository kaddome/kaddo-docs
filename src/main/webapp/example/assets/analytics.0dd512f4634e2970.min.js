var NAP=NAP||{},dataLayer=dataLayer||[];NAP.analytics=function(){"use strict";function a(){if(!I){if(!L||"undefined"==typeof s)return b(),!1;I=!0}if(clearTimeout(z),K.length<1)return k("fireQueuedTags: No tags in queue"),!1;for(var a=K.length,c=!1,d=0;a>d;++d)if(K[d].hasOwnProperty("varName"))s[K[d].varName]=K[d].value;else if(K[d].hasOwnProperty("tag")){if("t"===K[d].tag){c=!0;continue}s[K[d].tag]?s[K[d].tag].apply(s,K[d].params):k(K[d].tag+" not available in s")}return c&&(k("Tracking pageview from queue"),r(),s.t()),!0}function b(b){var c=30,d=500;if(++J,J>c){if("undefined"==typeof s)return k("queueTag: Given up waiting for Adobe Tag Manager"),clearTimeout(z),!1;k("queueTag: Given up waiting for doneHeader"),L=!0}b&&K.push(b),clearTimeout(z),z=setTimeout(function(){a()},d)}function c(c,d){if(c||l("fireTag: no tag specified"),!I){if("undefined"==typeof s||!L)return b({tag:c,params:d}),!1;I=!0,a()}return d=d||[],s[c]?s[c].apply(s,d):k(c+" not available in s"),!0}function d(c,d){if(!c)return l("setValue: no tag specified"),!1;if(!I){if("undefined"==typeof s||!L)return b({varName:c,value:d}),!1;a()}return d=d||"",s[c]=d,!0}function e(){-1===document.cookie.indexOf("s_tagEnv")&&(document.cookie="s_tagEnv=dev;%20path=/",k("Set Development mode cookie"))}function f(){window.location.hostname;h()&&e(),y="nap",t(D,"trackingServer","metrics.net-a-porter.com"),t(D,"trackingServerSecure","smetrics.net-a-porter.com"),o(D,"trackingServer"),o(D,"trackingServerSecure")}function g(){var a=$(document.body);a.data("region")&&t(C,"region",a.data("region")),a.data("language")&&t(C,"language",a.data("language")),a.data("country")&&t(C,"shippingCountry",a.data("country"))}function h(){if("undefined"==typeof x){var a=window.location.hostname;x=-1!==a.indexOf("dave")||-1!==a.indexOf("localhost")||-1!==a.indexOf(".nap")||-1!==a.indexOf("-dev")||a.match(/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/)}return x}function i(a){return $.isArray(w)||(w=$("body").data("analytics-disable").split(",")),!$.inArray(a,w)}function j(a){return"string"!=typeof a&&(a=""+a),a=a.replace(/[\r\n\t]/g,"")}function k(a,b){h()&&"object"==typeof console&&console.log&&(b?console.log("ANALYTICS: "+a,b):console.log("ANALYTICS: "+a))}function l(a){h()&&"object"==typeof console&&console.error&&console.error("ANALYTICS: "+a)}function m(){"object"==typeof analyticsPageData&&(t(D,"pageName",analyticsPageData.title),t(D,"channel",""),t(D,"category",analyticsPageData.category),t(D,"department",analyticsPageData.department),t(D,"subsection1",analyticsPageData.subsection1),t(D,"subsection2",analyticsPageData.subsection2),t(D,"class",analyticsPageData.pageClass),t(D,"pageType",analyticsPageData.pageType),"undefined"!=typeof analyticsPageData.autoPageview&&(H="false"!==analyticsPageData.autoPageview),analyticsPageData.extension.listPageData&&analyticsPageData.extension.listPageData.description&&t(C,"listingData",analyticsPageData.extension.listPageData.description))}function n(){f(),$(function(){m(),g(),H?(k("Auto-tracked Pageview"),NAP.analytics.trackPageview()):k("Auto-track disabled")})}function o(a,b){"undefined"==typeof a&&l("addLinkVar: undefined map"),a.hasOwnProperty(b)?-1===$.inArray(a[b],E)&&E.push(a[b]):l("addLinkVar: variable "+b+" does not exist")}function p(){E=["channel","shippingCountry","language"],F=[],G=[],"undefined"!=typeof s&&(s.linkTrackEvents=null)}function q(){if(F.length>0){var a=[];$.each(F,function(){var b=this.split("=");a.push(b[0])}),t(D,"linkTrackEvents",a.join(",")),t(D,"events",F.join(","),!0),k("Tracking events",F),o(D,"events")}G.length>0&&(s.products=G.join(","),k("Tracking products",s.products),o(D,"products")),t(D,"linkTrackVars",E.join(",")),k("Link vars",E),p()}function r(){F.length>0&&(s.events=F.join(",")),G.length>0&&(s.products=G.join(",")),p()}function t(a,b,c,e){"undefined"==typeof a&&l("setVar: undefined map"),a.hasOwnProperty(b)?e?d(a[b],c):d(a[b],j(c)):l("setVar: variable "+b+" does not exist")}function u(a,b,c){var d,e=[],f=CookieUtil.getCookie("NAPfindingMethod"+b);if(f){var g=f.split("|"),h=g[0].split("=");if(a=h[1],"undefined"!=typeof g[1]){var i=g[1].split("=");d=i[1]}}return null!==a&&"undefined"!=typeof a?(k("Adding finding method of ",a),e.push(C.productFindMethod+"="+a),null!==d&&""!==d&&"undefined"!=typeof d&&(k("Adding referring PID",d),e.push(C.crosssellItem+"="+d))):k("No finding method",a),c&&e.push(C.DiscountPercentage+"="+c),e.join("|")}function v(a,b){return a=a?$(a).parents(".product-details-analytics"):$(".product-details-analytics"),{event:"addToCart",ecommerce:{currencyCode:a.data("currency"),add:{products:[{name:a.data("name"),id:a.data("pid")||b,price:a.data("price"),brand:a.data("brand"),category:a.data("category"),quantity:1}]}}}}var w,x,y,z,A,B={productView:"prodView",openBag:"scOpen",addToBag:"scAdd",viewBag:"scView",removeFromBag:"scRemove",checkout:"scCheckout",purchase:"purchase",customProductView:"event1",searchSuccess:"event2",nullSearch:"event3",cardError:"event4",backButton:"event5",helpOverlay:"event6",formComplete:"event7",predictiveSearch:"event8",socialShare:"event9",imageZoom:"event10",productPageOverlay:"event11",wishlistAdd:"event12",wishlistRemove:"event13",discount:"event14",signup:"event15",register:"event16",returnGenerated:"event17",bagAlert:"event18",wishlistAlert:"event19",bagAddPopup:"event20",useAccordion:"event21",useCarousel:"event22",useDiscountCode:"event23",useGiftCard:"event24",linkData:"event25",hazmat:"event26",hasItemInBasket:"event27",videoPlayed:"event34",videoCompleted:"event35",videoTime:"event41",videoViews:"event42",videoCompletes:"event43",videoSegmentViews:"event44",outOfStockProductView:"event46",limitedStockProductView:"event47",selectSize:"event48",listPageView:"event49",payPalSelected:"event50"},C={purchaseID:"purchaseID",productName:"products",campaign:"campaign",website:"eVar1",application:"eVar2",region:"eVar3",internalSearch:"eVar4",numSearchResults:"eVar5",campaignStack:"eVar6",campaignFirstClick:"eVar7",campaignLastClick:"eVar8",visitNumber:"eVar9",timeParting:"eVar10",shippingMethod:"eVar11",paymentMethod:"eVar12",productFindMethod:"eVar13",logInOut:"eVar14",adobeVisitorID:"eVar15",listingData:"eVar16",helpOverlayType:"eVar17",filterType:"eVar18",filterValue:"eVar19",formID:"eVar20",shippingCountry:"eVar21",shippingCity:"eVar22",customerNo:"eVar23",customerID:"eVar24",orderCurrency:"eVar25",language:"eVar26",productDetailAccordionType:"eVar27",imageID:"eVar28",crosssellItem:"eVar29",socialType:"eVar30",size:"eVar31",siteType:"eVar32",appName:"eVar33",signupSource:"eVar34",registrationSource:"eVar35",returnOrderProduct:"eVar36",brandPreference:"eVar37",accordionID:"eVar38",searchResultType:"eVar39",navigationArea:"eVar40",videoID:"eVar43",DiscountPercentage:"eVar45",videoSegment:"eVar62",videoContentType:"eVar44",stockDetails:"eVar46",stockDetailsHighLevel:"eVar47",purchaseFrom:"eVar50"},D={pageName:"pageName",channel:"channel",domain:"server",category:"prop1",department:"prop2",subsection1:"prop3",subsection2:"prop13","class":"prop4",pageType:"prop5",timeParting:"prop6",newReturn:"prop7",pageViewedPercent:"prop8",errorURL:"prop9",errorReferer:"prop10",adobeVisitorID:"prop11",sizeAvailable:"prop12",pageEvent:"prop36",errorDetails:"prop43",trackingServer:"trackingServer",trackingServerSecure:"trackingServerSecure",events:"events",account:"s_account",linkTrackEvents:"linkTrackEvents",linkTrackVars:"linkTrackVars",products:"products"},E=["channel","shippingCountry","language"],F=[],G=[],H=!0,I=!1,J=0,K=[],L=!1,M=[],N=!1;return n(),{LINK_DOWNLOAD:"d",LINK_EXIT:"e",LINK_CUSTOM:"o",setPageVar:function(a,b,c,d){t(D,a,b,d),"undefined"!=typeof c&&c&&o(D,a),k("Setting page variable "+a,b)},setConversionVar:function(a,b,c,d){t(C,a,b,d),"undefined"!=typeof c&&c&&o(C,a),k("Setting conversion variable "+a,b)},addEvent:function(a,b){if(B.hasOwnProperty(a)){if(-1===$.inArray(a,F)){k("Adding event "+B[a]);var c=B[a];"undefined"!=typeof b&&(c+="="+j(b)),F.push(c)}}else l("addEvent: event "+a+" not found")},addProduct:function(a,b,c,d){var e=(""+a).split("-")[0];if("undefined"!=typeof b&&null!==b){var f=parseInt(b,10)*parseFloat(c);k("Adding order product: "+b+" x "+e+" @ "+c);var g=";"+j(e)+";"+j(b)+";"+j(f)+";;"+u(null,e,d);M.push({sku:a,pid:e,quantity:b,unitPrice:c})}else{k("Adding basket product",e);var g=";"+j(e)+";;;;"+u(null,e,d)}k("Add product:",g),G.push(g)},setPageName:function(a){analyticsPageData.title=a,t(D,"pageName",a)},setPageType:function(a){analyticsPageData.pageType=a,this.setPageVar("pageType",a)},trackPageview:function(){if("object"==typeof analyticsPageData){analyticsPageData.category,analyticsPageData.pageType}if(""!==window.location.search){var a=decodeURI(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURI("keywords").replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"));""!==a&&t(C,"internalSearch",a)}if(""!==window.location.search)for(var b=window.location.search.substr(1).split("&"),d=b.length,e=0;d>e;++e){var f=b[e].split("=");2===f.length&&"keywords"===f[0].toLowerCase()&&t(C,"internalSearch",decodeURIComponent(f[1].replace(/\+/g," ")))}c("t"),k("Page view tracked")},trackElement:function(a,b,d,e,f){switch(b&&("object"!=typeof b||"href"in b)||(b="true"),d){case this.LINK_DOWNLOAD:case this.LINK_EXIT:break;default:d=this.LINK_CUSTOM}a=a.substr(0,100),e=e||null,f=f||"navigate",k("Element tag ("+d+")",b),q(),c("tl",[b,d,a,e,f])},trackInteraction:function(a,b,d,e,f){var g=a+" :: "+b,h={category:a,action:b},i={event:"trackInteraction",event_category:a,event_action:b,event_label:d};f=f||"prop36",d&&(g+=" :: "+d,h.label=d),e&&(g+=" :: "+e,h.value=e),analyticsPageData.events=analyticsPageData.events||[],analyticsPageData.events.push(h);var j={};j[f]=g,c("trackAction",[j]),dataLayer.push(i)},conditional:function(a,b){i(a)&&b()},trackAddToBag:function(a,b,c){if("undefined"==typeof a)return l("No PID to add"),!1;Array.isArray(a)||(a=[a]);var d=v(b,a[0]);b=b||!0,this.addEvent("addToBag");for(var e=0,f=a.length;f>e;e++)this.addProduct(a[e]);dataLayer.push(d),"undefined"==typeof c?this.trackElement("Add to Bag",b):this.trackElement("Add to Bag",b,this.LINK_CUSTOM,null,c)},trackBagSessionStart:function(a){("nap"===y&&!!CookieUtil.getCookie("shopping_basket")==!1||"mrp"===y&&"0"==$("#header-inject-bagcount").text()||"ton"===y&&"0"==$("#basket-items-count").text())&&(this.addEvent("openBag"),this.trackElement("Bag session start",a||!0))},trackOrderComplete:function(a){a=a||{},a.hasOwnProperty("orderID")&&(A=a.orderID,N=!0,this.setConversionVar("purchaseID",a.orderID)),a.hasOwnProperty("country")&&this.setConversionVar("shippingCountry",a.country),a.hasOwnProperty("city")&&this.setConversionVar("shippingCity",a.city),a.hasOwnProperty("paymentMethod")&&this.setConversionVar("paymentMethod",a.paymentMethod),a.hasOwnProperty("shippingMethod")&&this.setConversionVar("shippingMethod",a.shippingMethod),a.hasOwnProperty("orderCurrency")&&this.setConversionVar("orderCurrency",a.orderCurrency),a.hasOwnProperty("applicationName")&&this.setConversionVar("appName",a.applicationName),this.addEvent("purchase")},trackProductView:function(a,b){function c(){var a=/[\?&]resType=([^&#]*)/i.exec(location.search);null!==a&&NAP.analytics.addEvent("searchSuccess")}function d(a){var b=CookieUtil.getCookie("search_"+a);if(b){var c=b.split("|");analyticsPageData.search=analyticsPageData.search||{},analyticsPageData.search.entered=c[0],analyticsPageData.search.used=c[1],analyticsPageData.search.search_type=c[2],analyticsPageData.search.results_type=c[3],analyticsPageData.search.results_num=c[4]}}Array.isArray(a)||(a=[a]);var e=location.pathname.match(/\/\d+(\/)?/g)[0].replace(/\//g,"");g(),this.addEvent("productView"),this.addEvent("customProductView"),b&&this.addEvent("discount");var f=$("#shipping-restriction");f.length>0&&f.hasClass("hazmat")&&this.addEvent("hazmat"),k("Tracking product view for ",a);for(var h=0,i=a.length;i>h;h++)this.addProduct(a[h],null,null,b);d(e),c(),this.trackPageview(),k("Deleting finding method cookie: NAPfindingMethod"+e),CookieUtil.deleteCookieWithPath("NAPfindingMethod"+e)},getOrderConfirmation:function(){return N?{orderID:A,skus:M}:null},doneHeader:function(){L=!0,dataLayer&&dataLayer.push({event:"analyticsReady"})},recordFindingMethod:function(){},setFindingNameCookie:function(a,b,c){var d=b.substring(b.indexOf("product/")+8,b.indexOf("product")+14),e=a?a:D.pageName,f=C.productFindMethod+"="+e;c&&c!==d&&(f+="|"+C.crosssellItem+"="+c);var g=new Date;g.setMinutes(g.getMinutes()+1);var h=encodeURIComponent(f);document.cookie="NAPfindingMethod"+d+"="+h+";expires="+g.toUTCString()+";path=/",k("Set finding cookie: NAPfindingMethod"+d,h)},trackStockDetails:function(a){var b=function(a){var b={};for(var c in a)b[a[c]]=c;return b},c={ins:"IN_STOCK",out:"OUT_OF_STOCK",soon:"COMING_SOON",low:"LOW_STOCK",one:"ONE_LEFT"},d=b(c),e="ONE_SIZE",f="MULTIPLE_SIZES",g="",h="";if(a.type==e){var i="";a.sizes.length>0&&"n/a"!=a.sizes[0].name&&(i="-withdd"),a.sizes[0].status==c.ins?(g="one-size@in",h="one-size"+i+"@all in stock"):a.sizes[0].status==c.out?(g="one-size@"+d[c.out],h="one-size"+i+"@out completely",this.addEvent("outOfStockProductView"),t(D,"pageType","PRODUCT DETAILS PAGE - SOLD OUT")):a.sizes[0].status==c.soon?(g="one-size@"+d[c.soon],h="one-size"+i+"@out back-soon",this.addEvent("outOfStockProductView")):a.sizes[0].status==c.low?(g="one-size@"+d[c.low],h="one-size"+i+"@partial stock",this.addEvent("limitedStockProductView")):a.sizes[0].status==c.one&&(g="one-size@"+d[c.one],h="one-size"+i+"@partial stock",this.addEvent("limitedStockProductView"))}else if(a.type==f){for(var j,k=[],m=!0,n=!0,o=0;o<a.sizes.length;o++)j=o+1==a.sizes.length?"":":",g+=a.sizes[o].name+"@"+("ins"==d[a.sizes[o].status]?"in":d[a.sizes[o].status])+j,k.push(d[a.sizes[o].status]),a.sizes[o].status!=c.ins&&(m=!1),(a.sizes[o].status==c.ins||a.sizes[o].status==c.soon||a.sizes[o].status==c.low||a.sizes[o].status==c.one)&&(n=!1);var p=$.grep(k,function(a){return"out"==a}).length,q=$.grep(k,function(a){return"soon"==a}).length,r=p+q==k.length?!0:!1;m?h="multiple@all in stock":n?(h="multiple@out completely",this.addEvent("outOfStockProductView"),t(D,"pageType","PRODUCT DETAILS PAGE - SOLD OUT")):($.inArray("one",k)>-1||$.inArray("low",k)>-1)&&-1==$.inArray("out",k)&&-1==$.inArray("soon",k)?(h="multiple@partial stock",this.addEvent("limitedStockProductView")):(p>0&&p!=k.length||q>0&&q!=k.length)&&!r?(h="multiple@partially sold out",this.addEvent("limitedStockProductView")):q>0&&p==k.length-q&&(h="multiple@out back-soon",this.addEvent("outOfStockProductView"),t(D,"pageType","PRODUCT DETAILS PAGE - SOLD OUT"))}else l("Invalid size type",a.type);this.setConversionVar("stockDetailsHighLevel",h,!1,!0),this.setConversionVar("stockDetails",g,!1,!0)}}}();