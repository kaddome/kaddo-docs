if(typeof Array.prototype.splice==="undefined"){Array.prototype.splice=function(b,l){var g=0,j=arguments,k=this.copy(),h=b;if(!l){l=this.length-b;}for(g;g<j.length-2;g++){this[b+g]=j[g+2];}for(b;b<this.length-l;b++){this[b+j.length-2]=k[b-l];}this.length-=l-j.length+2;return k.slice(h,h+l);};}var baseUrl="";var maxURLLength=2083;var urlPaddingLength=100;var LPChatAPINS=window.LPChatAPINS||{};LPChatAPINS.lpConnLibNS="LPChatAPINS";LPChatAPINS.hcArrayStorage=function(){this.idx=0;this.nArr=[];this.vArr=[];};LPChatAPINS.hcArrayStorage.prototype.add=function(d,b,c){if(typeof(c)=="undefined"){c=false;}if(typeof(b)=="undefined"){var a=d.split("=");d=a[0];b=a[1];}if(c){this.nArr[this.idx]=unescape(d);this.vArr[this.idx]=unescape(b);}else{this.nArr[this.idx]=d;this.vArr[this.idx]=b;}this.idx++;};LPChatAPINS.hcArrayStorage.prototype.size=function(){return this.idx;};LPChatAPINS.hcArrayStorage.prototype.get=function(b){if(typeof(this.nArr[b])=="undefined"){return"";}var a=escape(this.nArr[b])+"="+escape(this.vArr[b]);a=a.replace(/\+/g,"%2B");return a;};LPChatAPINS.hcArrayStorage.prototype.getName=function(a){return this.nArr[a];};LPChatAPINS.hcArrayStorage.prototype.getValue=function(a){return this.vArr[a];};LPChatAPINS.hcArrayStorage.prototype.getValueEsc=function(a){return escape(this.vArr[a]);};LPChatAPINS.hcArrayStorage.prototype.getByName=function(b){for(var a=0;a<this.idx;a++){if(this.getName(a)==b){return a;}}return -1;};LPChatAPINS.hcArrayStorage.prototype.remove=function(a){if(typeof(a)=="undefined"||a==null||typeof(this.nArr[a])=="undefined"){return;}this.nArr.splice(a,1);this.vArr.splice(a,1);this.idx--;};LPChatAPINS.hcArrayStorage.prototype.paramLength=function(b){var a="&"+this.get(b);return a.length;};LPChatAPINS.hcArrayStorage.prototype.fullLength=function(){var b=0;for(var a=0;a<this.idx;a++){b+=this.paramLength(a);}return b;};LPChatAPINS.hcArrayStorage.prototype.getMaxLengthItem=function(){var a=0;var c=-1;for(var b=0;b<this.idx;b++){if(this.paramLength(b)>a){a=this.paramLength(b);c=b;}}return c;};LPChatAPINS.hcArrayStorage.prototype.clone=function(){var a=new LPChatAPINS.hcArrayStorage();a.idx=this.idx;for(var b=0;b<this.idx;b++){a.nArr[b]=this.nArr[b];a.vArr[b]=this.vArr[b];}return a;};LPChatAPINS.lpRequest=function(v,k,s,f,m,p,b,d,e,t,j,u,a,n,r,g,l,q,c,i,o,h){this.headLoc=document.getElementsByTagName("head").item(0);this.timeStamp=new Date();this.callId=this.BuildCallID();this.protocolVer=v;this.scriptId="lpScriptId"+this.callId;this.callbackFunc=f;this.requireConfirm=m;this.spImmediateCleanup=u;this.postAutoConfirm=j;this.params=s;this.BaseUrl=k;this.fullUrl="";if(typeof(e)!="undefined"&&e!=""&&e!=null){this.dataEncoding=e.toUpperCase();}else{this.dataEncoding="UTF-8";}this.retries=0;this.confirmed=false;this.usedget=true;this.usedSpecialPost=false;this.maxretries=p;this.prunId=b;this.lpjson=d;this.browser=t;this.spImmediateCleanup=true;if(typeof(a)=="undefined"){a=false;}this.partial=a;if(typeof(n)=="undefined"){n=0;}this.part=n;if(typeof(r)=="undefined"){r=0;}this.outOf=r;this.forceget=g;this.forcePost=l;this.encodingBlankUrl=q;this.minimizePost=c;this.minimizePostMaxGets=i;this.allowTruncate=o;if(typeof(h)!="undefined"&&h!=""&&h!=null){this.callTimeoutPeriod=h;}else{this.callTimeoutPeriod=20;}};LPChatAPINS.lpRequest.prototype.BuildCallID=function(){var b=this.getCookie("HumanClickKEY");var a=999999999999;if(b==null){b=Math.round(Math.random()*999999999999);}return b+"-"+Math.round(Math.random()*9999999999);};LPChatAPINS.lpRequest.prototype.getCookie=function(d){var c=document.cookie.indexOf(d+"=");var a=c+d.length+1;if((!c)&&(d!=document.cookie.substring(0,d.length))){return null;}if(c==-1){return null;}var b=document.cookie.indexOf(";",a);if(b==-1){b=document.cookie.length;}return unescape(document.cookie.substring(a,b));};LPChatAPINS.lpRequest.prototype.BuildBaseCallUrl=function(){var a=this.BaseUrl;if(a.indexOf("?")==-1){a+="?";}else{a+="&";}a+="lpCallId="+this.callId;a+="&protV="+this.protocolVer;a+="&"+this.prunId+this.lpjson;return a;};LPChatAPINS.lpRequest.prototype.BuildCallUrl=function(e,a,c){var f=this.BuildBaseCallUrl();var b=f.length;if(e=="get"){if(this.params.size()>0){for(var d=0;d<this.params.size();d++){f+="&"+this.params.get(d);}}b=f.length;if(b>a){if(!c&&window.lpConnLib&&window.lpConnLib.log){window.lpConnLib.log("BuildCallUrl Cut length:"+b+" m="+a,"WARN","EMT");}f=f.substring(0,a);}}this.fullUrl=f;return b;};LPChatAPINS.lpRequest.prototype.MakeCallByScript=function(){this.scriptObj=document.createElement("script");this.scriptObj.setAttribute("type","text/javascript");this.scriptObj.setAttribute("charset",this.dataEncoding);this.scriptObj.setAttribute("src",this.fullUrl);this.scriptObj.setAttribute("id",this.scriptId);this.headLoc.appendChild(this.scriptObj);};LPChatAPINS.lpRequest.prototype.removeScriptTag=function(){try{this.headLoc.removeChild(this.scriptObj);}catch(a){if(LPChatAPINS.lpConnLib.DebugDisplay&&typeof lpMTagDebug!="undefined"){lpMTagDebug.Display("lpRequest.removeScriptTag FAILED with error:"+a,"ERROR","EMT");}}};LPChatAPINS.lpRequest.prototype.clone=function(){var a=new LPChatAPINS.lpRequest();for(var b in this){if(typeof(this[b])!="undefined"){if(typeof(this[b])!="object"){a[b]=this[b];}else{if(typeof(this[b])!="undefined"&&this[b]!=null&&this[b].constructor==hcArrayStorage){a[b]=this[b].clone();}else{a[b]=this[b];}}}}return a;};LPChatAPINS.lpConnectionLibrary=function(){this.protocolVer=20;this.garbagePeriod=2;this.gcT=0;this.maxurllengthMZ=2083;this.maxurllengthIE=2083;this.postDeleteIfrDelay=3;this.iframeName="lpIframeContainer-"+Math.round(1000*Math.random());this.onPostAutoConfirm=true;this.queue=[];this.partialQueue=[];this.fullForPartialQueue={};this.browser=this.BrowserSniff();this.maxurlgetlength=2083;this.callCounter=0;this.garbageCollectCounter=0;this.forcedGet=0;this.reconfirmedCalls=0;this.resendCounter=0;this.partialCounter=0;this.lpExecuteErrors=0;this.lpCallbackCnt=0;this.lpjson=1;this.prunId="lpjson=";this.DebugSend=true;this.DebugDisplay=false;this.postParams=[];this.spPostIframesFree=[];this.spPostIframesBusy=[];};LPChatAPINS.lpConnectionLibrary.prototype.SortQueue=function(d,c){try{if(d.confirmed==c.confirmed){return d.timeStamp.getTime()-c.timeStamp.getTime();}if(d.confirmed&&!c.confirmed){return -1;}if(!d.confirmed&&c.confirmed){return 1;}return 0;}catch(f){this.reportError(f,"SortQueue");}};LPChatAPINS.lpConnectionLibrary.prototype.confirmConnection=function(c){try{var f=","+c+",";for(var b=0;b<this.queue.length;b++){var a=","+this.queue[b].callId+",";if(!this.queue[b].confirmed&&f.indexOf(a)>-1){this.queue[b].confirmed=true;}}}catch(d){this.reportError(d,"confirmConnection");}};LPChatAPINS.lpConnectionLibrary.prototype.getRequestForCallId=function(b){try{for(var a=0;a<this.queue.length;a++){if(b==this.queue[a].callId){return this.queue[a];}}return null;}catch(c){this.reportError(c,"getRequestForCallId");}};LPChatAPINS.lpConnectionLibrary.prototype.addToQueue=function(m,v,h,o,q,i,r,f,g,n,c,w,s,k,b,p,j){try{var x="";var l=false;if(typeof(f)!="undefined"){this.lpjson=f;}if(typeof(r)!="undefined"){l=r;}else{l=this.onPostAutoConfirm;}if(typeof(s)=="undefined"){if(typeof(lpMTagConfig)!="undefined"){s=lpMTagConfig.lpProtocol+"://"+lpMTagConfig.lpServer+"/hcp/asp/blankenc.asp";}else{if(typeof(lpChatConfig)!="undefined"){s=lpChatConfig.lpProtocol+"://"+lpChatConfig.lpServer+"/hcp/asp/blankenc.asp";}}}this.encodingBlankUrl=s;if(typeof(w)=="undefined"){w=true;}if(typeof LPChatAPINS.lpConnLibNS!="undefined"){v.add("ccn",LPChatAPINS.lpConnLibNS);}var d=new LPChatAPINS.lpRequest(this.protocolVer,m,v,h,o,q,this.prunId,this.lpjson,g,this.browser,l,w,undefined,0,0,i,n,s,k,b,p,j);if(typeof(lpMTagDebug)!="undefined"&&typeof(lpMTagDebug.Display)!="undefined"){this.DebugDisplay=true;}if(i){this.forcedGet++;}var a="";var u=d.BuildCallUrl("get",this.maxurlgetlength,true);if(!n&&(u<this.maxurlgetlength||i)){x=this.makeTheCall(d,"get",o);}else{x="THE_MESSAGE_IS_TOO_LARGE_FOR_HTTP_GET_REQUEST";}return x;}catch(t){this.reportError(t,"addToQueue");}};LPChatAPINS.lpConnectionLibrary.prototype.makeTheCall=function(c,g){try{g=g.toUpperCase();var b,a;if(g=="GET"){c.BuildCallUrl("get",this.maxurlgetlength);a=this.queue.length;this.queue[a]=c;this.queue[a].MakeCallByScript();if(!c.requireConfirm){this.queue[a].confirmed=true;}b="GET";}if(this.DebugDisplay){var d="";try{d=c.params.getValue(c.params.getByName("cmd"));if(typeof(d)=="undefined"){d=c.fullUrl.match(/cmd=.*?&/).toString();if(d!=null&&d!="null"){d=d.replace(/&/g,"");}}d='<strong><span style="color:rgb(255,153,0);">'+d+"</span></strong>";}catch(f){}this.log("Making "+g+" Call id="+c.callId+" "+d,"DEBUG","EMT");}this.callCounter++;return b;}catch(f){this.reportError(f,"makeTheCall");}};LPChatAPINS.lpConnectionLibrary.prototype.hasNonLatinChars=function(c){try{for(var a=0;a<c.size();a++){if(c.get(a).indexOf("%u")!=-1){return true;}}return false;}catch(b){this.reportError(b,"hasNonLatinChars");}};LPChatAPINS.lpConnectionLibrary.prototype.BrowserSniff=function(){try{var d=navigator.userAgent.toLowerCase();if(d.indexOf("safari")!=-1){return"SAFARI";}if(document.all){var b=(d.indexOf("opera")!=-1);if(b){return"OPR";}else{return"IE";}}if(document.getElementById){var a=(d.indexOf("firefox")!=-1);if(a){return"FF";}return"MOZ";}return"MOZ";}catch(c){this.reportError(c,"BrowserSniff");}};LPChatAPINS.lpConnectionLibrary.prototype.GetCallbackFunc=function(a){try{var d=this.queue.length;for(var b=0;b<d;b++){if(this.queue[b].callId==a){return this.queue[b].callbackFunc;}}return null;}catch(c){this.reportError(c,"GetCallbackFunc");}};LPChatAPINS.lpConnectionLibrary.prototype.CleanUpBusySpecialPost=function(b){try{if(typeof(b)=="undefined"){b=null;}for(var a=0;a<this.spPostIframesBusy.length;a++){if((this.spPostIframesBusy[a]["spImmediateCleanup"]&&this.spPostIframesBusy[a]["callMade"])||this.spPostIframesBusy[a]["callID"]==b){this.releaseIframe(this.spPostIframesBusy[a]["callID"]);}}}catch(c){this.reportError(c,"CleanUpBusySpecialPost");}};LPChatAPINS.lpConnectionLibrary.prototype.gc=function(){try{this.log("GC","OK","EMT");this.queue.sort(this.SortQueue);var a=0;var c;for(c=0;c<this.queue.length;c++){if(this.queue[c].confirmed){if(this.queue[c].usedget){this.queue[c].removeScriptTag();}a++;}}this.queue.splice(0,a);this.garbageCollectCounter++;this.CleanUpBusySpecialPost();var b=new Date().getTime();for(c=0;c<this.queue.length;c++){if(!this.queue[c].confirmed&&(b-this.queue[c].timeStamp.getTime())>this.queue[c].callTimeoutPeriod*1000){if(this.queue[c].retries<this.queue[c].maxretries){this.queue[c].retries++;this.callCounter++;this.reconfirmedCalls++;this.log("Retry "+this.queue[c].retries+"/"+this.queue[c].maxretries+" cId="+this.queue[c].callId,"DEBUG","EMT");this.queue[c].timeStamp=new Date();if(this.queue[c].usedget){this.queue[c].MakeCallByScript();}else{if(this.usedSpecialPost){this.CleanUpBusySpecialPost(this.queue[c].callId);this.specialPostHandler(this.queue[c].callId);}else{this.queue[c].MakeCallByIframe(this.browser);}}}else{this.queue[c].confirmed=true;this.log("Timeout for cId="+this.queue[c].callId,"DEBUG","EMT");var d={ResultSet:{lpCallId:this.queue[c].callId,lpCallError:"TIMEOUT"}};this.UsrCFn(d);}}}}catch(f){this.reportError(f,"gc");}};LPChatAPINS.lpConnectionLibrary.prototype.Process=function(d){try{if(d==null){this.log("Cback No data","ERROR","EMT");return;}this.lpCallbackCnt++;var dRS=d.ResultSet;d.ServiceInfo={};var dSI=d.ServiceInfo;if(dRS.lpCallId==0||dRS.lpCallId==null||dRS.lpCallId==""){this.log("Cback No Call ID","ERROR","EMT");return;}dSI.requestType="REGULAR";dSI.resendCall=false;dSI.origCallId=dRS.lpCallId;if(typeof(dRS.lpData)!="undefined"&&typeof(dRS.lpData)=="object"&&typeof(dRS.lpData[0])!="undefined"){if(typeof(dRS.lpData[0].TYPE)!="undefined"){dSI.requestType=dRS.lpData[0].TYPE;}if(typeof(dRS.lpData[0].RESEND)!="undefined"){dSI.resendCall=dRS.lpData[0].RESEND;}}if(dSI.resendCall){this.resendCounter++;}if(dSI.requestType=="PARTIAL REQUEST"){dRS.lpCallId=dRS.lpCallId+"!"+dRS.lpData[0].PART;}this.log("Cback cId="+dRS.lpCallId,"DEBUG","EMT");if(typeof(dRS.lpCallConfirm)=="undefined"||dRS.lpCallConfirm==""){dRS.lpCallConfirm=dRS.lpCallId;}else{dRS.lpCallConfirm+=","+dRS.lpCallId;}var req;if(dSI.requestType=="PARTIAL REQUEST"&&dSI.resendCall){req=this.fullForPartialQueue[dSI.origCallId];delete this.fullForPartialQueue[dSI.origCallId];this.log("CId="+dRS.lpCallId+" Deleted - fullForPartialQueue["+dSI.origCallId+"]","DEBUG","EMT");}else{req=this.getRequestForCallId(dRS.lpCallId);if(req!=null&&req.partial){req=this.fullForPartialQueue[dSI.origCallId];}}if(dSI.requestType!="PARTIAL REQUEST"){if(this.fullForPartialQueue[dSI.origCallId]){delete this.fullForPartialQueue[dSI.origCallId];this.log("CId="+dRS.lpCallId+" Deleted fullForPartialQueue["+dSI.origCallId+"]","DEBUG","EMT");}}if(req==null){this.log("REQ is NULL callId="+dSI.origCallId,"ERROR","EMT");}this.confirmConnection(dRS.lpCallConfirm);if(dSI.requestType=="PARTIAL REQUEST"){var callNum;var outOfcalls;if(typeof(dRS.lpData)!="undefined"&&typeof(dRS.lpData)=="object"){if(typeof(dRS.lpData[0].PART)!="undefined"){callNum=dRS.lpData[0].PART;}if(typeof(dRS.lpData[0].OUTOF)!="undefined"){outOfcalls=dRS.lpData[0].OUTOF;}}if(dSI.resendCall){for(var i=(callNum+1);i<=outOfcalls;i++){var cid=dSI.origCallId+"!"+i;delete this.partialQueue[cid];}}else{try{var ncId=dSI.origCallId+"!"+(callNum+1);this.log("P Call Response recieved  - "+dRS.lpCallId+" part="+callNum+" outof="+outOfcalls,"DEBUG","EMT");var r=this.partialQueue[ncId];if(r!=null){delete this.partialQueue[ncId];if(r.part==r.outOf){r.callId=this.spPartFromStr(r.callId);}this.makeTheCall(r,"get");}else{if(typeof(dbg)!="undefined"&&dbg.Display){dbg.Display("P Call NOT found for id="+ncId,"ERROR","EMT");}}}catch(e){if(typeof(dbg)!="undefined"&&dbg.Display){dbg.Display("P Call Proces error for id="+dRS.lpCallId+" exception="+e,"ERROR","EMT");}}return;}}if(typeof(dRS.lpJS_Execute)!="undefined"){var d_msg=[];for(var MTagI=0;MTagI<dRS.lpJS_Execute.length;MTagI++){var no_err_flag=true;var err_msg="";var code_id=dRS.lpJS_Execute[MTagI].code_id;try{eval(dRS.lpJS_Execute[MTagI].js_code);if(typeof(lpMTag)!="undefined"&&typeof(lpMTag.tmpCode)!="undefined"&&lpMTag.tmpCode!=""){eval(lpMTag.tmpCode);}}catch(hcExecError){this.lpExecuteErrors++;no_err_flag=false;err_msg=hcExecError;}if(typeof(lpMTag)!="undefined"){lpMTag.tmpCode="";}if(this.DebugDisplay){if(no_err_flag){d_msg[d_msg.length]="OK Executed snippet=<strong>"+code_id+"</strong><!!>EXEC-OK";}else{d_msg[d_msg.length]="ERROR Executing snippet=<strong>"+code_id+"</strong> &nbsp #"+err_msg+"#<!!>ERROR";}}}if(this.DebugDisplay){lpMTagDebug.DisplayArray(d_msg,"EMT");}}if(typeof(dRS.lpCallError)!="undefined"){this.log("ERR Recieved="+dRS.lpCallError+" &nbsp # CallID = "+dRS.lpCallId+"#","ERROR","EMT");}this.UsrCFn(d,req);}catch(e){this.reportError(e,"Process");}};LPChatAPINS.lpConnectionLibrary.prototype.spPartFromStr=function(c){try{var a=c.split("!");return a[0];}catch(b){this.reportError(b,"spPartFromStr");}};LPChatAPINS.lpConnectionLibrary.prototype.UsrCFn=function(h,f){try{var b=this.GetCallbackFunc(h.ResultSet.lpCallId);if(b!=""&&b!=null){var a=true;var i="";try{b(h,f);}catch(c){a=false;i=c;}if(a){this.log("OK Exec User function - "+h.ResultSet.lpCallId,"EXEC-OK","EMT");}else{this.log("ERROR Exec User function="+b+" &nbsp #"+i+"#","ERROR","EMT");}}}catch(g){this.reportError(g,"UsrCFn");}};LPChatAPINS.lpConnectionLibrary.prototype.setReportErrorParams=function(b,a){this.reportErrorUrl=b;this.reportErrorSite=a;};LPChatAPINS.lpConnectionLibrary.prototype.log=function(a,b,c){if(this.DebugDisplay){lpMTagDebug.Display(a,b,c);}};LPChatAPINS.lpConnectionLibrary.prototype.reportError=function(c,b){if(typeof(console)!="undefined"){console.log(c+" "+b);}if(!this.DebugSend||!lpChatConfig.apiDebugSend||!this.reportErrorUrl||!this.reportErrorSite){return;}var d;if(c&&(c.name||c.message)){d="reportErrorChat Exception: "+c.name+" : "+c.message+" : "+b;}else{d="reportErrorChat: "+b;}var a=new Image();a.src=this.reportErrorUrl+"?cmd=visitorDebugPrint&site="+this.reportErrorSite+"&logger=CHAT_JS_API&d="+(new Date()).getTime()+"&log="+d;};if(typeof(LPChatAPINS.lpConnLib)=="undefined"){LPChatAPINS.lpConnLib=new LPChatAPINS.lpConnectionLibrary();LPChatAPINS.lpConnLib.garbageTimer=setInterval(function(){LPChatAPINS.lpConnLib.gc();},LPChatAPINS.lpConnLib.garbagePeriod*1000);}function lpJSLibrary(){}var lpJSLib=new lpJSLibrary();function lpChat(){try{this.ver="1.1";this.ErrorValue={CHAT_NOT_INITIALIZED:{id:1,text:"Chat not initialized."},CHAT_ALREADY_ENDED:{id:2,text:"Chat already ended"},CANNOT_INITIALIZE_CHAT:{id:3,text:"Cannot initialize chat"},SERVICE_UNAVAILABLE:{id:4,text:"Chat is unavailable."},API_NOT_ALLOWED:{id:5,text:"API is not allowed for this account."},ACCOUNT_EXPIRED:{id:6,text:"Account has expired."},INCORRECT_CHATKEY:{id:7,text:"Chat key is incorrect."},INVALID_APP_KEY:{id:8,text:"Invalid application key."},API_ADAPTER_NOT_INSTALLED:{id:9,text:"API Adapter not installed."},APP_KEY_NOT_INSTALLED:{id:10,text:"Application key is not installed in the account."},APP_KEY_DISABLED:{id:11,text:"Application key has been disabled by the administrator."},CSDS_GENERAL_ERROR:{id:12,text:"Could not resolve the account service domain."},SEND_LINE_TO_NON_EXISTING_CHAT:{id:13,text:"Trying to send a line, but there is no current chat session."},THE_MESSAGE_IS_TOO_LARGE_FOR_HTTP_GET_REQUEST:{id:14,text:"The message is too large for HTTP GET request."}};this.LineType={VISITOR:0,AGENT:1,SYSTEM:2,URL:3,HTML:4};this.STATE={"2":{id:2,text:"In chat"},"4":{id:4,text:"Waiting for chat"},"6":{id:6,text:"Chat ended"}};var f=lpChatConfig;this.apiKey=f.apiKey;this.lpServer=f.lpServer;this.lpNumber=f.lpNumber;this.lpProtocol=f.lpProtocol;this.ssoKey=f.ssoKey;this.skill=f.skill;this.agent=f.agent;this.baseUrl=this.lpProtocol+"://"+this.lpServer+"/hc/"+this.lpNumber+"/";this.prunId="lpjson=";this.tmpCallId="6716764257869836657-2116828845";this.lpjson=1;if(this.lpServer){LPChatAPINS.lpConnLib.setReportErrorParams(this.baseUrl,this.lpNumber);}for(var a in f){this[a]=f[a];}this.isSafari2OrBelow=false;this.isSafari3orUp=false;var d=navigator.userAgent;var b=d.indexOf("AppleWebKit/");if(b!=-1){this.isSafari3orUp=d.charAt(b+12)>="5";}this.initVars();this.lastReceivedEvent=-1;this.delayedActions=[];this.getConfigCompleted=false;this._getCSDSDomain(this.lpNumber);}catch(c){this.reportError(c,"lpChat");}}lpChat.prototype.createLine=function(f,d,a,c){try{return{text:f,by:d,type:a,time:c};}catch(b){this.reportError(b,"createLine");}};lpChat.prototype.initVars=function(){try{this.visitorEventsPollRate=2000;this.sessionkey=-1;this.state=-1;this.inChat=false;this.chatEnded=false;this.stopComm=false;this.chatLines=[];this.visitorTitle="you:";this.requests=[];this.callInProgress=false;this.veTimer=null;this.isNonUTF8orENGencoding=false;if(typeof(lpChatConfig.charSet)!="undefined"){var a=lpChatConfig.charSet.toUpperCase();this.isNonUTF8orENGencoding=(a!="UTF-8"&&a!="UTF8"&&a!="ISO-8859-1");}this.baseUrl=lpChatConfig.lpProtocol+"://"+this.lpServer+"/hc/"+this.lpNumber+"/";LPChatAPINS.lpConnLib.setReportErrorParams(this.baseUrl,this.lpNumber);this.failCounter=0;this.rtSessionId=-1;}catch(b){this.reportError(b,"initVars");}};lpChat.prototype.addLine=function(h){try{if(!this.inChat){this.callOnErrorCallback(this.ErrorValue.SEND_LINE_TO_NON_EXISTING_CHAT);return false;}if(this.stopComm){return false;}if(h==null||h==""){return false;}var a=this.createLine(h,this.visitorTitle,this.LineType.VISITOR,this.jsGetDate());var g=this.chatLines.length;this.chatLines[g]=a;var d=new LPChatAPINS.hcArrayStorage();d.add("cmd","visitorSays");this.addChatParameters(d);d.add("text",h);d.add("lastLineTime",new Date().getTime());var b=this.buildURL(d,true);if(b.length>maxURLLength){var c=maxURLLength-(this.buildURL(d,false).length+urlPaddingLength);this.splitRequest(d,c);}else{this.addRequestToQueue(d);}}catch(f){this.reportError(f,"addLine");}};lpChat.prototype.splitRequest=function(g,e){var h="";var f="";var d=0;var a="";if(g.size()>0){for(var c=0;c<g.size();c++){if(g.nArr[c]=="text"){h=escape(g.vArr[c]).replace(/\+/g,"%2B");f=g.vArr[c];}}}var b=h.split("%20");for(c=0;c<b.length;c++){if(b[c].length>e){this.reportError("word is too long to send","addLine");return;}if(d+b[c].length+3>e){a=unescape(h.substring(0,d).replace("%2B","+"));this.sendText(a);a="";h=h.substring(d,h.length);d=0;}d+=b[c].length;d+=3;}this.sendText(unescape(h.replace("%2B","+")));};lpChat.prototype.sendText=function(b){var a=new LPChatAPINS.hcArrayStorage();a.add("cmd","visitorSays");this.addChatParameters(a);a.add("text",b);a.add("lastLineTime",new Date().getTime());this.addRequestToQueue(a);};lpChat.prototype.buildBaseCallUrl=function(){var a=this.baseUrl;if(a.indexOf("?")==-1){a+="?";}else{a+="&";}a+="lpCallId="+this.tmpCallId;a+="&protV="+this.lpProtocol;a+="&"+this.prunId+this.lpjson;return a;};lpChat.prototype.buildURL=function(c,b){var d=this.buildBaseCallUrl();c.add("se","12");c.add("ccn","LPChatAPINS");if(c.size()>0){for(var a=0;a<c.size();a++){if(b){d+="&"+c.get(a);}else{if(c.nArr[a]!="text"){d+="&"+c.get(a);}else{d+=escape(c.nArr[a])+"=";}}}}c.remove(c.size()-1);c.remove(c.size()-1);return d;};lpChat.prototype.addInfoLine=function(c){try{if(!this.inChat||this.stopComm||c==null||c==""){return false;}var a=new LPChatAPINS.hcArrayStorage();a.add("cmd","visitorInfo");this.addChatParameters(a);a.add("text",c);this.addRequestToQueue(a);}catch(b){this.reportError(b,"addInfoLine");}};lpChat.prototype.setVisitorTyping=function(a){try{var d="visitorTyping "+(a?1:0);var b=new LPChatAPINS.hcArrayStorage();b.add("cmd","visitorRepCommand");b.add("params",d);this.sendVisitorCommand(b);}catch(c){this.reportError(c,"setVisitorTyping");}};lpChat.prototype.setCustomVariable=function(d,c){try{var a=new LPChatAPINS.hcArrayStorage();a.add("cmd","visitorSetUDE");a.add("cvn",d);a.add("val",c);this.sendVisitorCommand(a);}catch(b){this.reportError(b,"setCustomVariable");}};lpChat.prototype.endChat=function(){try{var a=new LPChatAPINS.hcArrayStorage();a.add("cmd","windowUnloaded");this.sendVisitorCommand(a);this.stopChatComm();}catch(b){this.reportError(b,"endChat");}};lpChat.prototype.requestTranscriptEmail=function(a){try{var b=new LPChatAPINS.hcArrayStorage();b.add("cmd","file");b.add("file","emailRequest");b.add("email",a);this.sendVisitorCommand(b);}catch(c){this.reportError(c,"requestTranscriptEmail");}};lpChat.prototype.getVisitorName=function(){return this.visitorTitle;};lpChat.prototype.setVisitorName=function(a){try{this.setCustomVariable("identifier",a);}catch(b){this.reportError(b,"setVisitorName");}};lpChat.prototype.getAgentName=function(){try{if(typeof(this.agent)=="undefined"){return null;}else{return this.agent;}}catch(a){this.reportError(a,"getAgentName");}};lpChat.prototype.getAgentLoginName=function(){try{if(typeof(this.agentLoginName)=="undefined"){return null;}else{return this.agentLoginName;}}catch(a){this.reportError(a,"getAgentLoginName");}};lpChat.prototype.getAgentId=function(){try{if(typeof(this.agentId)=="undefined"){return null;}else{return this.agentId;}}catch(a){this.reportError(a,"getAgentId");}};lpChat.prototype.getState=function(){try{if(typeof(this.STATE[this.state])!="undefined"){return this.STATE[this.state];}else{return{id:this.state};}}catch(a){this.reportError(a,"getState");}};lpChat.prototype.getLines=function(){return this.chatLines;};lpChat.prototype.hasPendingRequests=function(){try{return this.requests.length>0;}catch(a){this.reportError(a,"hasPendingRequests");}};lpChat.prototype.getSessionKey=function(){return this.sessionkey;};lpChat.prototype.getRtSessionId=function(){return this.rtSessionId;};lpChat.prototype.requestConfig=function(){try{var a=new LPChatAPINS.hcArrayStorage();a.add("site",this.lpNumber);a.add("cmd","requestConfig");var b=this;LPChatAPINS.lpConnLib.addToQueue(b.baseUrl,a,function(e){b._requestConfigCallback(e);},true,-1,true,false,4,"UTF-8",false,false,false);}catch(c){this.reportError(c,"requestConfig");}};lpChat.prototype._requestConfigCallback=function(c){try{this.getConfigCompleted=true;while(this.delayedActions.length>0){var a=this.delayedActions.shift();a();}this.handleErrorResponse(c);}catch(b){this.reportError(b,"_requestConfigCallback");}};lpChat.prototype._getCSDSDomain=function(d){try{var g=new LPChatAPINS.hcArrayStorage();var a="";var c=this;var b="/service/adminArea/baseURI.lpCsds?version=1.0&ccn=LPChatAPINS";if(typeof(lpChatConfig.csdsDomain)!="undefined"&&lpChatConfig.csdsDomain!=null&&lpChatConfig.csdsDomain!=""){a=lpChatConfig.csdsHttpProtocol+"://"+lpChatConfig.csdsDomain+"/csdr/account/"+d+b;}else{a="https://adminlogin.liveperson.net/csdr/account/"+d+b;}LPChatAPINS.lpConnLib.addToQueue(a,g,function(i){try{var h=i.ResultSet.lpCallError;if(typeof(h)!="undefined"&&h!=null&&h!=""){i.ResultSet.lpCallError="CSDS_GENERAL_ERROR";c.handleResponse(i);}else{lpChatConfig.lpServer=i.ResultSet.lpData[0].lpServer;c.lpServer=lpChatConfig.lpServer;c.baseUrl=c.lpProtocol+"://"+c.lpServer+"/hc/"+c.lpNumber+"/";c.requestConfig();}}catch(j){this.log(j);i.ResultSet.lpCallError="CSDS_GENERAL_ERROR";c.handleResponse(i);}},true,1,true,true,4,"UTF-8");}catch(f){this.reportError(f,"_getCSDSDomain");}};lpChat.prototype.requestChat=function(d){try{if(!this.getConfigCompleted){var g=this;this.delayedActions.push(function(){g.requestChat(d);});return;}if(this.sessionkey!=-1){this.lastReceivedEvent=-1;}this.initVars();var l=new LPChatAPINS.hcArrayStorage();var i=window.lpChatConfig||{};var j=LPChatAPINS.lpRequest.prototype.getCookie;var k=j.call(null,i.FPC_VID_NAME?i.FPC_VID_NAME:this.lpNumber+"-VID");var m=j.call(null,i.FPC_SKEY_NAME?i.FPC_SKEY_NAME:this.lpNumber+"-SKEY");var f=j.call(null,i.FPC_CONT_NAME?i.FPC_CONT_NAME:"HumanClickSiteContainerID_"+this.lpNumber);if(f){l.add("siteContainer",f);}if(k){l.add("visitor",k);}if(m){l.add("msessionkey",m);}l.add("cmd","file");l.add("file","visitorWantsToChat");l.add("appKey",this.apiKey);if(typeof(d)!="undefined"&&d!=null){if(typeof(d.a2aInfo)!="undefined"&&d.a2aInfo!=null){var n=d.a2aInfo;this.lpNumber=n.remoteSiteid;this.remoteDomain=n.remoteDomain;this.a2aSessionId=n.a2aSessionId;this.a2aEventid=n.a2aEventid;this.a2aSiteid=n.a2aSiteid;this.identifier=n.identifier;if(typeof(this.remoteDomain)!="undefined"&&this.remoteDomain!=null&&this.remoteDomain!=""){this.lpServer=this.remoteDomain;lpChatConfig.lpServer=this.remoteDomain;}this.baseUrl=lpChatConfig.lpProtocol+"://"+this.lpServer+"/hc/"+this.lpNumber+"/";l.add("a2aSessid",this.a2aSessionId);l.add("a2aEventid",this.a2aEventid);l.add("a2aSiteid",this.a2aSiteid);l.add(lpChatConfig.visitorVar+"identifier",this.identifier);}if(typeof(d.customVariables)!="undefined"&&d.customVariables!=null){var a=d.customVariables;for(var b in a){l.add(lpChatConfig.sessVar+b,a[b]);}}}l.add("site",this.lpNumber);this.ssoKey=lpChatConfig.ssoKey;if(typeof(this.ssoKey)!="undefined"&&this.ssoKey!=null&&this.ssoKey!=""){l.add("ssoKey",this.ssoKey);}this.agent=lpChatConfig.agent;if(typeof(this.agent)!="undefined"&&this.agent!=null&&this.agent!=""){l.add(lpChatConfig.sessVar+lpChatConfig.operatorUDE,this.agent);}this.skill=lpChatConfig.skill;if(typeof(this.skill)!="undefined"&&this.skill!=null&&this.skill!=""){l.add(lpChatConfig.sessVar+lpChatConfig.skillUDE,this.skill);}if(this.invitation){l.add("referrer","(engage) "+document.location);this.invitation=false;}else{l.add("referrer",document.location);}this.addRequestToQueue(l);}catch(h){this.reportError(h,"requestChat");}};lpChat.prototype.resumeChat=function(c){try{if(!this.getConfigCompleted){var a=this;this.delayedActions.push(function(){a.resumeChat(c);});return;}this.sessionkey=c;this.startChatSequence();}catch(b){this.reportError(b,"resumeChat");}};lpChat.prototype.startChatSequence=function(){try{var a=new LPChatAPINS.hcArrayStorage();a.add("cmd","visitorWantsToChat");a.add("isOn","false");this.addChatParameters(a);this.addRequestToQueue(a);}catch(b){this.reportError(b,"startChatSequence");}};lpChat.prototype.addChatParameters=function(a){try{a.add("appKey",this.apiKey);a.add("site",this.lpNumber);a.add(lpChatConfig.sessionKeyParam,this.sessionkey);}catch(b){this.reportError(b,"addChatParameters");}};lpChat.prototype.sendVisitorEvents=function(){try{clearTimeout(this.veTimer);this.veTimer=null;if(this.stopComm){return;}var a=new LPChatAPINS.hcArrayStorage();a.add("cmd","visitorEvents");this.addChatParameters(a);this.addRequestToQueue(a);}catch(b){this.reportError(b,"sendVisitorEvents");}};lpChat.prototype.sendVisitorCommand=function(a){try{if(this.stopComm){if(this.chatEnded){this.callOnErrorCallback(this.ErrorValue.CHAT_ALREADY_ENDED);}else{this.callOnErrorCallback(this.ErrorValue.CHAT_NOT_INITIALIZED);}return;}this.addChatParameters(a);this.addRequestToQueue(a);}catch(b){this.reportError(b,"sendVisitorCommand");}};lpChat.prototype.callOnErrorCallback=function(a){if(typeof(this["onError"])=="function"){try{this.onError(a);}catch(b){this.reportError(b,"Exception at callOnErrorCallback");}}};lpChat.prototype.callCallback=function(d,b,a){try{d(b,a);}catch(c){this.reportError(c,"Exception at "+d.name);}};lpChat.prototype.handleEvents=function(b){try{var a=b.ResultSet.lpData.length;for(var d=0;d<a;d++){var c=b.ResultSet.lpData[d];if(typeof(c)=="undefined"){continue;}this.lastReceivedEvent=c.eSeq;this._handleEvent(c);}}catch(f){this.reportError(f,"handleEvents");}};lpChat.prototype._handleEvent=function(j){try{if(j.eName=="sessionkey"){this.sessionkey=j.params[0];if(j.params.length>=2){this.rtSessionId=j.params[1];}this.startChatSequence();if(typeof(this["onInit"])=="function"){this.callCallback(this.onInit,null,null);}}else{if(j.eName=="addLine"){var l=this.createLine(j.params[0],j.params[1],j.params[2],j.params[3]);var k=this.chatLines.length;this.chatLines[k]=l;k++;if(typeof(this["onLine"])=="function"){this.callCallback(this.onLine,l,null);}}else{if(j.eName=="repTyping"){var b=j.params[0]=="1";if(typeof(this["onAgentTyping"])=="function"){this.callCallback(this.onAgentTyping,b,null);}}else{if(j.eName=="urlPush"){var g=j.params[0];if(typeof(this["onUrlPush"])=="function"&&g!=""){this.callCallback(this.onUrlPush,g,null);}}else{if(j.eName=="startChat"){this.agent=j.params[1];this.inChat=true;if(typeof(this["onStart"])=="function"){this.callCallback(this.onStart,j.params[0],j.params[1]);}}else{if(j.eName=="visitorState"){this.state=j.params[0];this.agentId=j.params[1];this.agent=j.params[2];if(j.params.length>3){this.agentLoginName=j.params[3];}this.inChat=this.state==2;if(typeof(this["onState"])=="function"){if(typeof(this.STATE[j.params[0]])!="undefined"){this.callCallback(this.onState,this.STATE[j.params[0]],null);}else{this.callCallback(this.onState,{id:j.params[0]},null);}}}else{if(j.eName=="stopChat"){var i=j.params[0];var f=j.params[1];this.stopChatComm();if(typeof(this["onStop"])=="function"){this.callCallback(this.onStop,i,f);}}else{if(j.eName=="visitorSet"){if(j.params[0]=="visitorTitle"){this.visitorTitle=j.params[1];}else{if(j.params[0]=="agentName"){this.agent=j.params[1];}}}else{if(j.eName=="availability"){if(j.params[0]=="offline"){this.callOnErrorCallback(this.ErrorValue.CANNOT_INITIALIZE_CHAT);this.chatEnded=true;}}else{if(j.eName=="resume"){if(j.params.length>=2){this.rtSessionId=j.params[1];}if(typeof(this["onResume"])=="function"){this.callCallback(this.onResume,this.agentId,this.agent);}}else{if(j.eName=="accountToAccountTransfer"){this.inChat=false;var d={a2aInfo:{remoteSiteid:j.params[0],remoteDomain:j.params[1],sessidParam:j.params[2],eventId:j.params[3],sourceSiteid:j.params[4],remoteSkillName:j.params[5],identifier:j.params[6]}};if(typeof(this["onAccountToAccountTransfer"])=="function"){this.callCallback(this.onAccountToAccountTransfer,d);}}else{if(j.eName=="collaboration"){if(typeof(this["onCollaboration"])=="function"){var c=this.createJSONCollaborationEvent(j);this.callCallback(this.onCollaboration,c,null);}}else{if(j.eName=="redirect"){var a=j.params[0]+"&appKey="+this.apiKey;this.directSendRequest(a);}else{if(j.eName=="apiNotAllowed"){this.callOnErrorCallback(this.ErrorValue.API_NOT_ALLOWED);this.chatEnded=true;}else{if(j.eName=="apiAdapterIsMissing"){this.callOnErrorCallback(this.ErrorValue.API_ADAPTER_NOT_INSTALLED);this.chatEnded=true;}else{if(j.eName=="invalidAppKey"){this.callOnErrorCallback(this.ErrorValue.INVALID_APP_KEY);this.chatEnded=true;}else{if(j.eName=="accountExpired"){this.callOnErrorCallback(this.ErrorValue.ACCOUNT_EXPIRED);this.chatEnded=true;}else{if(j.eName=="APP_KEY_NOT_INSTALLED"){this.callOnErrorCallback(this.ErrorValue.APP_KEY_NOT_INSTALLED);this.chatEnded=true;}else{if(j.eName=="APP_KEY_DISABLED"){this.callOnErrorCallback(this.ErrorValue.APP_KEY_DISABLED);this.chatEnded=true;}}}}}}}}}}}}}}}}}}}}catch(h){this.reportError(h,"_handleEvent");}};lpChat.prototype.stopChatComm=function(){try{this.inChat=false;this.chatEnded=true;this.stopComm=true;}catch(a){this.reportError(a,"stopChatComm");}};lpChat.prototype.handleResponse=function(a){try{if(typeof(a.ResultSet.lpCallError)=="undefined"){try{this.handleEvents(a);}catch(c){this.reportError(c,"Exception at handleEvents");}this.requests.shift();if(this.requests.length==0){this.handleEmptyQueue();}else{this.sendRequestFromQueue();}this.failCounter=0;}else{try{this.handleErrorResponse(a);}catch(c){this.reportError(c,"Exception at handleErrorResponse");}if(!this.stopComm){var b=this;setTimeout(function(){b.sendRequestFromQueue();},this.visitorEventsPollRate);}}}catch(c){this.reportError(c,"handleResponse()");}};lpChat.prototype.handleEmptyQueue=function(){try{if(this.requests.length==0){this.callInProgress=false;if(!this.chatEnded&&this.sessionkey!=-1&&this.veTimer==null){var a=this;this.veTimer=setTimeout(function(){a.sendVisitorEvents();},this.visitorEventsPollRate);}}}catch(b){this.reportError(b,"handleEmptyQueue");}};lpChat.prototype.handleErrorResponse=function(a){try{if(typeof(a.ResultSet.lpCallError)=="undefined"){return;}var b=a.ResultSet.lpCallError;if(typeof(console)!="undefined"){console.log("handleErrorResponse: "+b);}if(b=="BUSY"||b=="TIMEOUT"){this.callOnErrorCallback(this.ErrorValue.SERVICE_UNAVAILABLE);if(this.failCounter++>lpChatConfig.maxRetries){this.reportError(null,"handleErrorResponse: maxRetries exceeded: "+lpChatConfig.maxRetries);this.stopChatComm();}}else{if(b=="CSDS_GENERAL_ERROR"){if(typeof(this.lpServer)!="undefined"&&this.lpServer!=null&&this.lpServer!=""){this.requestConfig();}else{this.callOnErrorCallback(this.ErrorValue.CSDS_GENERAL_ERROR);}}else{if(b=="VISITORNOTFOUND"){if(this.chatEnded){this.callOnErrorCallback(this.ErrorValue.CHAT_ALREADY_ENDED);}else{this.callOnErrorCallback(this.ErrorValue.CHAT_NOT_INITIALIZED);}if(this.inChat){this.stopChatComm();}else{this.stopComm=true;}}else{if(b.indexOf("Chat key")==0){this.callOnErrorCallback(this.ErrorValue.INCORRECT_CHATKEY);this.stopChatComm();}else{if(b=="API_NOT_ALLOWED"){this.callOnErrorCallback(this.ErrorValue.API_NOT_ALLOWED);this.stopChatComm();}else{if(b=="INVALID_APP_KEY"){this.callOnErrorCallback(this.ErrorValue.INVALID_APP_KEY);this.stopChatComm();}else{if(b=="API_ADAPTER_NOT_INSTALLED"){this.callOnErrorCallback(this.ErrorValue.API_ADAPTER_NOT_INSTALLED);this.stopChatComm();}else{if(b=="ACCOUNT_EXPIRED"){this.callOnErrorCallback(this.ErrorValue.ACCOUNT_EXPIRED);this.stopChatComm();}else{if(b=="APP_KEY_NOT_INSTALLED"){this.callOnErrorCallback(this.ErrorValue.APP_KEY_NOT_INSTALLED);this.stopChatComm();}else{if(b=="APP_KEY_DISABLED"){this.callOnErrorCallback(this.ErrorValue.APP_KEY_DISABLED);this.stopChatComm();}}}}}}}}}}}catch(c){this.reportError(c,"handleErrorResponse");}};lpChat.prototype.addRequestToQueue=function(b){try{this.requests.push(b);if(!this.callInProgress){this.callInProgress=true;this.sendRequestFromQueue();}}catch(a){this.reportError(a,"addRequestToQueue");}};lpChat.prototype.sendRequestFromQueue=function(){try{if(this.requests.length==0){return;}var d=this;var f=false;}catch(g){this.reportError(g,"sendRequestFromQueue first block");}while(!f){try{var a=this.requests[0];var c=false;var b=true;if(a.getValue(0)=="visitorSays"){b=false;c=this.isSafari2OrBelow&&LPChatAPINS.lpConnLib.hasNonLatinChars(a);}if(a.size()>0&&a.getName(a.size()-1)!="se"){a.add("se",this.lastReceivedEvent+1);}var h=LPChatAPINS.lpConnLib.addToQueue(this.baseUrl,a,function(e){d.handleResponse(e);},true,-1,b,false,4,lpChatConfig.charSet,c,(this.isSafari3orUp&&this.isNonUTF8orENGencoding),false,undefined,undefined,undefined,undefined,lpChatConfig.callTimeoutPeriod);if(h=="THE_MESSAGE_IS_TOO_LARGE_FOR_HTTP_GET_REQUEST"){this.callOnErrorCallback(this.ErrorValue.THE_MESSAGE_IS_TOO_LARGE_FOR_HTTP_GET_REQUEST);}else{f=true;}}catch(g){this.reportError(g,"sendRequestFromQueue: remove the request");}if(!f){try{this.requests.shift();if(this.requests.length==0){this.handleEmptyQueue();return;}}catch(g){this.reportError(g,"sendRequestFromQueue second block");}}}};lpChat.prototype.reportError=function(b,a){LPChatAPINS.lpConnLib.reportError(b,a);};lpChat.prototype.jsGetDate=function(){var a=new Date();return a.getTime();};lpChat.prototype.chatAvailability=function(c){try{var a=this;if(!this.getConfigCompleted){this.delayedActions.push(function(){a.chatAvailability(c);});return;}var d=new LPChatAPINS.hcArrayStorage();d.add("cmd","chatAvailability");d.add("appKey",this.apiKey);d.add("site",this.lpNumber);if(typeof(c)!="undefined"){if(typeof(c.agent)!="undefined"&&c.agent!=""){d.add("agent",c.agent);}if(typeof(c.skill)!="undefined"&&c.skill!=""){d.add("skill",c.skill);}if(typeof(c.queue)!="undefined"&&c.queue!=""){d.add("queue",c.queue);}if(typeof(c.maxWaitTime)!="undefined"&&c.maxWaitTime!==""){d.add("maxWaitTime",c.maxWaitTime);}}LPChatAPINS.lpConnLib.addToQueue(this.baseUrl,d,function(e){a.handleAvailability(e);},true,-1,true,false,4,lpChatConfig.charSet,false,false,false);}catch(b){this.reportError(b,"chatAvailability");}};lpChat.prototype.handleAvailability=function(a){try{if(typeof(a.ResultSet.lpCallError)!="undefined"){this.handleErrorResponse(a);}else{if(a.ResultSet.lpData.length>0){var c=a.ResultSet.lpData[0];if(typeof(c.error)!="undefined"&&typeof(this["onError"])=="function"){this.callOnErrorCallback(c);}else{if(typeof(this["onAvailability"])=="function"){this.onAvailability(c);}}}}}catch(b){this.reportError(b,"handleAvailability()");}};lpChat.prototype.requestChatFromInvite=function(){try{this.invitation=true;this.requestChat();}catch(a){this.reportError(a,"requestChatFromInvite");}};lpChat.prototype.requestChatFromDynButton=function(a){this.directSendRequest(a);};lpChat.prototype.directSendRequest=function(a){try{var b=this;LPChatAPINS.lpConnLib.addToQueue(a,new LPChatAPINS.hcArrayStorage(),function(e){b.handleResponse(e);},true,-1,true,false,4,lpChatConfig.charSet,false,false,false);}catch(c){this.reportError(c,"directSendRequest");}};if(window.lpChatConfig&&typeof(lpChatConfig.onLoad)=="function"){lpChatConfig.onLoad();}lpChat.prototype.createJSONCollaborationEvent=function(d){try{var b={};for(var c in d.params){var a=parseInt(c);if((a>2)&&(a%2!=0)){b[d.params[a]]=d.params[a+1];}}return{channelType:d.params[0],sessionID:d.params[1],command:d.params[2],args:b};}catch(f){this.reportError(f,"createJSONCollaborationEvent");}};lpChat.prototype.sendCollaborationEvent=function(c){try{var d=new LPChatAPINS.hcArrayStorage();d.add("cmd","collaboration");d.add("sessionID",c.sessionID);d.add("collaborationCommand",c.command);d.add("channel",c.channelType);var b=1;for(var h in c.args){var a=c.args[h];d.add("arg"+b+".name",h);d.add("arg"+b+".value",a);b++;}this.addChatParameters(d);var f=this;LPChatAPINS.lpConnLib.addToQueue(f.baseUrl,d,function(e){},true,-1,true,false,4,"UTF-8",false,false,false);}catch(g){this.reportError(g,"sendCollaborationEvent");}};